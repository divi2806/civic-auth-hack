{"version":3,"file":"walletUtils.js","sourceRoot":"","sources":["../../src/lib/walletUtils.ts"],"names":[],"mappings":"AASA,OAAO,EAAc,MAAM,MAAM,CAAC;AAClC,OAAO,KAAK,MAAM,MAAM,aAAa,CAAC;AAEtC,yEAAyE;AACzE,gDAAgD;AAChD,mCAAmC;AACnC,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAY,CAAC;AAEnD,MAAM,CAAC,MAAM,IAAI,GACf,ohCAA6hC,CAAC;AAEhiC,MAAM,CAAC,MAAM,SAAS,GAAG,CACvB,WAAgC,EACG,EAAE,CACrC,CAAC,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC;AAEjE,MAAM,CAAC,MAAM,aAAa,GAAG,CAC3B,WAAgC,EACQ,EAAE,CAC1C,CAAC,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;AAEhD,MAAM,eAAe,GAAG,CAAI,GAAiB,EAA2B,EAAE,CACxE,GAAG,CAAC,MAAM,GAAG,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,KAAK,SAAS,CAAC;AAEzC;;;GAGG;AACH,MAAM,CAAC,MAAM,0BAA0B,GAAG,CAAC,KAAY,EAAW,EAAE;IAClE,MAAM,QAAQ,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC;IAC5C,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE,CAAC;QAC/B,MAAM,IAAI,KAAK,CAAC,oDAAoD,CAAC,CAAC;IACxE,CAAC;IACD,MAAM,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC;IAC/C,IAAI,MAAM,KAAK,SAAS,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,EAAE,CAAC;QACrD,MAAM,IAAI,KAAK,CACb,kEAAkE,CACnE,CAAC;IACJ,CAAC;IAED,OAAO;QACL,IAAI,EAAE,QAAQ;QACd,SAAS,EAAE,MAAM;KAClB,CAAC;AACJ,CAAC,CAAC;AAEF,yDAAyD;AACzD,kEAAkE;AAClE,kDAAkD;AAClD,8EAA8E;AAC9E,MAAM,CAAC,MAAM,iCAAiC,GAAG,CAC/C,MAA6B,EAC7B,EAAE;IACF,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CACvB,IAAI,GAAG,CAAC;QACN,GAAG,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QACrD,GAAG,CAAC,MAAM,CAAC,MAAM,IAAI,SAAS,CAAC;KAChC,CAAC,CACH,CAAC;IAEF,OAAO,CACL,MAAM,CAAC,SAAS,EAAE,IAAI;QACtB,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE;YAC3B,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,0BAA0B,CAAC,KAAK,CAAC,CAAC;YAClD,OAAO,GAAG,CAAC;QACb,CAAC,EAAE,EAAqB,CAAC,CAC1B,CAAC;AACJ,CAAC,CAAC","sourcesContent":["import type {\n  CivicWeb3ClientConfig,\n  EVMChainRpcUrls,\n  ExistingWeb3UserContext,\n  NewWeb3UserContext,\n  NonEmptyArray,\n  RpcUrls,\n  Web3UserContextType,\n} from \"../types.js\";\nimport { type Chain } from \"viem\";\nimport * as chains from \"viem/chains\";\n\n// to reduce bundle size we can disable loading all chains via an env var\n// const chainMap = () => import(\"viem/chains\");\n// load a list of chains from viem.\nconst allChains = Object.values(chains) as Chain[];\n\nexport const ICON =\n  \"data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjIxOSIgdmlld0JveD0iMCAwIDIxOCAyMTkiIHdpZHRoPSIyMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI2ZmZiI+PHBhdGggZD0ibTEzMS4yNDcgOTIuNzk3N2MwLTEyLjE2ODktOS44NjUtMjIuMDMzMS0yMi4wMzMtMjIuMDMzMS0xMi4xNjg3IDAtMjIuMDMzNSA5Ljg2NDEtMjIuMDMzNSAyMi4wMzMxIDAgOC41MTQzIDQuODM4IDE1Ljg4NzMgMTEuOTA4MSAxOS41NTUzbC04LjE2NTcgMzUuMzExaDM2LjU4MTFsLTguMTY1LTM1LjMxMWM3LjA2OS0zLjY2OCAxMS45MDgtMTEuMDQxIDExLjkwOC0xOS41NTUzeiIvPjxwYXRoIGQ9Im0xOTUuMzkyIDEzNi45ODNjLTQuMjc5IDMzLjIyNS0zMi43MjcgNTguOTg2LTY3LjA5OCA1OC45ODZoLTM4LjE2MTFjLTM3LjMxNjEgMC02Ny42NzUxLTMwLjM1OS02Ny42NzUxLTY3LjY3NXYtMzguMTYwM2MwLTM3LjMxNjIgMzAuMzU5LTY3LjY3NTIgNjcuNjc1MS02Ny42NzUyaDM4LjE2MTFjMzQuMzcxIDAgNjIuODE4IDI1Ljc2MjQgNjcuMDk4IDU4Ljk4NzJoMjIuNjA4Yy00LjM4Ni00NS42MzgzLTQyLjkzOC04MS40NDU3LTg5LjcwNi04MS40NDU3aC0zOC4xNjExYy00OS42OTk1IDAtOTAuMTMyOSA0MC40MzQyLTkwLjEzMjkgOTAuMTMzN3YzOC4xNjAzYzAgNDkuNyA0MC40MzM1IDkwLjEzNCA5MC4xMzI5IDkwLjEzNGgzOC4xNjExYzQ2Ljc2OCAwIDg1LjMyLTM1LjgwOCA4OS43MDYtODEuNDQ1eiIvPjwvZz48L3N2Zz4=\" as const;\n\nexport const isNewUser = (\n  userContext: Web3UserContextType,\n): userContext is NewWeb3UserContext =>\n  !Object.prototype.hasOwnProperty.call(userContext, \"ethereum\");\n\nexport const userHasWallet = (\n  userContext: Web3UserContextType,\n): userContext is ExistingWeb3UserContext =>\n  !!userContext.user && !isNewUser(userContext);\n\nconst isNonEmptyArray = <T>(arr: readonly T[]): arr is NonEmptyArray<T> =>\n  arr.length > 0 && arr[0] !== undefined;\n\n/**\n * Convert a chain to a set of RPC urls by using the defaults\n * @param chain\n */\nexport const defaultRpcNodeUrlsForChain = (chain: Chain): RpcUrls => {\n  const httpUrls = chain.rpcUrls.default.http;\n  if (!isNonEmptyArray(httpUrls)) {\n    throw new Error(\"Default rpc http urls must have at least one entry\");\n  }\n  const wsUrls = chain.rpcUrls.default.webSocket;\n  if (wsUrls !== undefined && !isNonEmptyArray(wsUrls)) {\n    throw new Error(\n      \"Default rpc ws urls must be undefined or have at least one entry\",\n    );\n  }\n\n  return {\n    http: httpUrls,\n    webSocket: wsUrls,\n  };\n};\n\n// Get the list of chain RPCs to be used by the provider.\n// If an explicit list is passed in via the config, then use that,\n// Otherwise use the default RPCs provided by Viem\n// Since metakeep can only have one rpc per chain, we take the first each time\nexport const getEthereumProviderRPCsFromConfig = (\n  config: CivicWeb3ClientConfig,\n) => {\n  const chains = Array.from(\n    new Set([\n      ...(config.initialChain ? [config.initialChain] : []),\n      ...(config.chains ?? allChains),\n    ]),\n  );\n\n  return (\n    config.endpoints?.rpcs ??\n    chains.reduce((acc, chain) => {\n      acc[chain.id] = defaultRpcNodeUrlsForChain(chain);\n      return acc;\n    }, {} as EVMChainRpcUrls)\n  );\n};\n"]}