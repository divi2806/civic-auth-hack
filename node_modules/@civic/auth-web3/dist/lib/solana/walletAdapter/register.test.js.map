{"version":3,"file":"register.test.js","sourceRoot":"","sources":["../../../../src/lib/solana/walletAdapter/register.test.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  describe,\n  it,\n  expect,\n  vi,\n  beforeEach,\n  type MockInstance,\n} from \"vitest\";\nimport {\n  registerWallet,\n  DEPRECATED_registerWallet,\n  RegisterWalletEvent,\n} from \"./register.js\";\nimport type { Wallet } from \"@wallet-standard/base\";\n\ndescribe(\"registerWallet\", () => {\n  let dummyWallet: Wallet;\n  let dispatchEventSpy: MockInstance;\n  let addEventListenerSpy: MockInstance;\n\n  beforeEach(() => {\n    dummyWallet = {} as Wallet;\n    vi.stubGlobal(\"window\", {\n      dispatchEvent: vi.fn(),\n      addEventListener: vi.fn().mockImplementation(() => {}),\n    });\n\n    dispatchEventSpy = vi\n      .spyOn(window, \"dispatchEvent\")\n      .mockImplementation(() => true);\n    addEventListenerSpy = vi\n      .spyOn(window, \"addEventListener\")\n      .mockImplementation(() => {});\n  });\n\n  it(\"should dispatch a register-wallet event that calls the API's register with the wallet\", () => {\n    registerWallet(dummyWallet);\n    expect(dispatchEventSpy).toHaveBeenCalled();\n\n    const eventArg = dispatchEventSpy.mock.calls[0]?.[0];\n    // Simulate invoking the event callback from the event detail.\n    const fakeAPI = { register: vi.fn() };\n    // eventArg.detail is a callback expecting an object with a register function.\n    eventArg.detail({ register: fakeAPI.register });\n    expect(fakeAPI.register).toHaveBeenCalledWith(dummyWallet);\n  });\n\n  it(\"should add a listener for 'wallet-standard:app-ready' that registers the wallet\", () => {\n    registerWallet(dummyWallet);\n    expect(addEventListenerSpy).toHaveBeenCalledWith(\n      \"wallet-standard:app-ready\",\n      expect.any(Function),\n    );\n    // Retrieve the listener function and simulate the event.\n    const listener = addEventListenerSpy.mock.calls[0]?.[1];\n    const fakeAPI = { register: vi.fn() };\n    listener({ detail: fakeAPI });\n    expect(fakeAPI.register).toHaveBeenCalledWith(dummyWallet);\n  });\n\n  it(\"should catch and ignore an event during event dispatch\", () => {\n    vi.spyOn(window, \"dispatchEvent\").mockImplementation(() => {\n      throw new Error(\"test error\");\n    });\n    registerWallet(dummyWallet);\n\n    expect(addEventListenerSpy).toHaveBeenCalledWith(\n      \"wallet-standard:app-ready\",\n      expect.any(Function),\n    );\n  });\n\n  it(\"should catch and ignore an event during event listener registration\", () => {\n    vi.spyOn(window, \"addEventListener\").mockImplementation(() => {\n      throw new Error(\"test error\");\n    });\n    // does not throw\n    registerWallet(dummyWallet);\n  });\n});\n\ndescribe(\"DEPRECATED_registerWallet\", () => {\n  let dummyWallet: Wallet;\n  let navigatorWallets: unknown[];\n\n  beforeEach(() => {\n    dummyWallet = {} as Wallet;\n    // Prepare a fake navigator.wallets array.\n    navigatorWallets = [];\n    vi.stubGlobal(\"window\", {\n      navigator: { wallets: navigatorWallets },\n      dispatchEvent: () => true,\n      addEventListener: () => {},\n    });\n  });\n\n  it(\"should call registerWallet and push to navigator.wallets\", () => {\n    DEPRECATED_registerWallet(dummyWallet);\n    expect(navigatorWallets.length).toBe(1);\n    // The pushed function should call register with the wallet.\n    const fakeRegisterFn = vi.fn();\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\n    (navigatorWallets[0] as Function)({ register: fakeRegisterFn });\n    expect(fakeRegisterFn).toHaveBeenCalledWith(dummyWallet);\n  });\n\n  it(\"should ignore missing navigator property on window\", () => {\n    vi.stubGlobal(\"window\", {});\n    // does not throw\n    DEPRECATED_registerWallet(dummyWallet);\n  });\n});\n\ndescribe(\"RegisterWalletEvent\", () => {\n  it(\"should store the provided callback in detail\", () => {\n    const dummyCallback = vi.fn();\n    const event = new RegisterWalletEvent(dummyCallback);\n    expect(event.detail).toBe(dummyCallback);\n  });\n\n  it(\"should have the correct event type\", () => {\n    const event = new RegisterWalletEvent(() => {});\n    expect(event.type).toBe(\"wallet-standard:register-wallet\");\n  });\n\n  it(\"should throw an error when preventDefault is called\", () => {\n    const event = new RegisterWalletEvent(() => {});\n    expect(() => event.preventDefault()).toThrow(\n      \"preventDefault cannot be called\",\n    );\n  });\n\n  it(\"should throw an error when stopImmediatePropagation is called\", () => {\n    const event = new RegisterWalletEvent(() => {});\n    expect(() => event.stopImmediatePropagation()).toThrow(\n      \"stopImmediatePropagation cannot be called\",\n    );\n  });\n\n  it(\"should throw an error when stopPropagation is called\", () => {\n    const event = new RegisterWalletEvent(() => {});\n    expect(() => event.stopPropagation()).toThrow(\n      \"stopPropagation cannot be called\",\n    );\n  });\n});\n"]}