{"version":3,"file":"webpackPlugin.test.js","sourceRoot":"","sources":["../../src/nextjs/webpackPlugin.test.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,UAAU,EAAE,MAAM,QAAQ,CAAC;AAC9D,OAAO,EAEL,8BAA8B,GAC/B,MAAM,oBAAoB,CAAC;AAC5B,OAAO,EAAE,MAAM,EAAE,MAAM,kBAAkB,CAAC;AAC1C,QAAQ,CAAC,eAAe,EAAE,GAAG,EAAE;IAC7B,UAAU,CAAC,GAAG,EAAE;QACd,EAAE,CAAC,aAAa,EAAE,CAAC;IACrB,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,wCAAwC,EAAE,GAAG,EAAE;QACtD,EAAE,CAAC,gEAAgE,EAAE,GAAG,EAAE;YACxE,MAAM,UAAU,GAAG,EAAE,OAAO,EAAE,WAAW,EAAE,CAAC;YAE5C,MAAM,MAAM,GAAG,8BAA8B,CAAC,UAAU,EAAE;gBACxD,yBAAyB,EAAE,IAAI;aAChC,CAAC,CAAC;YAEH,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,sDAAsD,EAAE,GAAG,EAAE;QACpE,EAAE,CAAC,6EAA6E,EAAE,GAAG,EAAE;YACrF,MAAM,UAAU,GAAG,EAAE,CAAC;YACtB,MAAM,YAAY,GAAG,8BAA8B,CAAC,UAAU,EAAE;gBAC9D,yBAAyB,EAAE,KAAK;aACjC,CAAC,CAAC;YAEH,6DAA6D;YAC7D,MAAM,aAAa,GAAG;gBACpB,OAAO,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE;aACvB,CAAC;YACF,MAAM,cAAc,GAAG,EAA0B,CAAC;YAClD,MAAM,cAAc,GAAG,YAAY,CAAC,OAAO,EAAE,CAC3C,aAAa,EACb,cAAc,CACf,CAAC;YAEF,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,CAAC,wBAAwB,CAAC,CAAC,CAAC,IAAI,CACjE,gCAAgC,CACjC,CAAC;YACF,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC,CAAC,IAAI,CACrE,oCAAoC,CACrC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,+EAA+E,EAAE,GAAG,EAAE;YACvF,8DAA8D;YAC9D,MAAM,eAAe,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,MAAW,EAAE,EAAE;gBAC5C,OAAO,EAAE,GAAG,MAAM,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC;YAC7C,CAAC,CAAC,CAAC;YACH,MAAM,UAAU,GAAG,EAAE,OAAO,EAAE,eAAe,EAAE,CAAC;YAChD,MAAM,YAAY,GAAG,8BAA8B,CAAC,UAAU,EAAE;gBAC9D,yBAAyB,EAAE,KAAK;aACjC,CAAC,CAAC;YAEH,MAAM,aAAa,GAAG;gBACpB,OAAO,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE;aACvB,CAAC;YACF,MAAM,cAAc,GAAG,EAA0B,CAAC;YAClD,MAAM,cAAc,GAAG,YAAY,CAAC,OAAO,EAAE,CAC3C,aAAa,EACb,cAAc,CACf,CAAC;YAEF,MAAM,CAAC,eAAe,CAAC,CAAC,gBAAgB,EAAE,CAAC;YAC3C,MAAM,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACjD,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,CAAC,wBAAwB,CAAC,CAAC,CAAC,IAAI,CACjE,gCAAgC,CACjC,CAAC;YACF,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC,CAAC,IAAI,CACrE,oCAAoC,CACrC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8BAA8B,EAAE,GAAG,EAAE;YACtC,MAAM,UAAU,GAAG,EAAE,CAAC;YACtB,MAAM,QAAQ,GAAG,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;YAEvD,8BAA8B,CAAC,UAAU,EAAE;gBACzC,yBAAyB,EAAE,KAAK;aACjC,CAAC,CAAC;YACH,MAAM,CAAC,QAAQ,CAAC,CAAC,oBAAoB,CACnC,wHAAwH,CACzH,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import { describe, it, expect, vi, beforeEach } from \"vitest\";\nimport {\n  type WebpackConfigContext,\n  withOptionalSolanaDependencies,\n} from \"./webpackPlugin.js\";\nimport { logger } from \"../lib/logger.js\";\ndescribe(\"webpackPlugin\", () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  describe(\"when enableSolanaWalletAdapter is true\", () => {\n    it(\"should return the original nextConfig and log enabling message\", () => {\n      const nextConfig = { someKey: \"someValue\" };\n\n      const result = withOptionalSolanaDependencies(nextConfig, {\n        enableSolanaWalletAdapter: true,\n      });\n\n      expect(result).toEqual(nextConfig);\n    });\n  });\n\n  describe(\"when enableSolanaWalletAdapter is false (or omitted)\", () => {\n    it(\"should modify webpack config alias when no original webpack function exists\", () => {\n      const nextConfig = {};\n      const resultConfig = withOptionalSolanaDependencies(nextConfig, {\n        enableSolanaWalletAdapter: false,\n      });\n\n      // Create a dummy webpack config with a resolve.alias object.\n      const webpackConfig = {\n        resolve: { alias: {} },\n      };\n      const webpackContext = {} as WebpackConfigContext;\n      const modifiedConfig = resultConfig.webpack?.(\n        webpackConfig,\n        webpackContext,\n      );\n\n      expect(modifiedConfig.resolve.alias[\"./useWalletOptional.js\"]).toBe(\n        \"./useWalletOptionalFallback.js\",\n      );\n      expect(modifiedConfig.resolve.alias[\"./useConnectionOptional.js\"]).toBe(\n        \"./useConnectionOptionalFallback.js\",\n      );\n    });\n\n    it(\"should call the original webpack function if provided and then modify aliases\", () => {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const originalWebpack = vi.fn((config: any) => {\n        return { ...config, originalCalled: true };\n      });\n      const nextConfig = { webpack: originalWebpack };\n      const resultConfig = withOptionalSolanaDependencies(nextConfig, {\n        enableSolanaWalletAdapter: false,\n      });\n\n      const webpackConfig = {\n        resolve: { alias: {} },\n      };\n      const webpackContext = {} as WebpackConfigContext;\n      const modifiedConfig = resultConfig.webpack?.(\n        webpackConfig,\n        webpackContext,\n      );\n\n      expect(originalWebpack).toHaveBeenCalled();\n      expect(modifiedConfig.originalCalled).toBe(true);\n      expect(modifiedConfig.resolve.alias[\"./useWalletOptional.js\"]).toBe(\n        \"./useWalletOptionalFallback.js\",\n      );\n      expect(modifiedConfig.resolve.alias[\"./useConnectionOptional.js\"]).toBe(\n        \"./useConnectionOptionalFallback.js\",\n      );\n    });\n\n    it(\"should log disabling message\", () => {\n      const nextConfig = {};\n      const debugSpy = vi.spyOn(logger.web3.config, \"debug\");\n\n      withOptionalSolanaDependencies(nextConfig, {\n        enableSolanaWalletAdapter: false,\n      });\n      expect(debugSpy).toHaveBeenCalledWith(\n        \"Disabling Solana Wallet Adapter mode - use fallback hooks in webpack-built projects to avoid dependency import errors.\",\n      );\n    });\n  });\n});\n"]}